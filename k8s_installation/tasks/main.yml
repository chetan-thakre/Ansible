---
# tasks file for k8s_installation

- name: copy the k8s repository file
  copy:
    src: kubernetes.repo
    dest: /etc/yum.repos.d/

- name: update yum repository and packages
  yum:
    name: '*'
    state: latest
 
- name: installing kubernetes
  yum:
    name: ['kubelet', 'kubeadm', 'kubectl', 'docker', 'python2-pip', 'libselinux-python']
    enablerepo: kubernetes
    state: present

- name: enabling and starting kubelet and docker service 
  service:
    name: "{{ item }}"
    state: started
    enabled: yes
  with_items: 
    - docker
    - kubelet

- name: disabling selinux status
  selinux:
    state: disabled

- name: disabling swap
  command: swapoff -a 

- name: initiating kubernetes master using kubeadm 
  command: ['kubeadm init', 'mkdir -p $HOME/.kube', 'cp -i /etc/kubernetes/admin.conf $HOME/.kube/config', 'chown $(id -u):$(id -g) $HOME/.kube/config' ]

